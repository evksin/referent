# План реализации функций кнопок

## Обзор
Необходимо реализовать три функции для кнопок: "О чем статья?", "Тезисы", "Пост для Telegram". Все функции используют парсинг статьи и AI через OpenRouter API.

## Текущее состояние
- ✅ Парсинг статьи реализован (`/api/parse`)
- ✅ Перевод статьи реализован (`/api/translate`)
- ✅ Интерфейс с кнопками создан
- ⏳ Функции кнопок используют моковые данные

## План действий

### Этап 1: Создание универсального API route для AI обработки

**Файл:** `app/api/ai-process/route.ts`

**Действия:**
1. Создать новый API route `/api/ai-process`
2. Принимать параметры:
   - `url` - URL статьи
   - `actionType` - тип действия: `summary`, `theses`, `telegram`
3. Использовать существующий `/api/parse` для получения данных статьи
4. Формировать промпт в зависимости от `actionType`:
   - `summary`: "Напиши краткое описание статьи на русском языке (2-3 абзаца)"
   - `theses`: "Выдели основные тезисы статьи в виде маркированного списка на русском языке"
   - `telegram`: "Создай пост для Telegram канала на русском языке с эмодзи и хештегами"
5. Вызывать OpenRouter API с моделью `deepseek/deepseek-chat`
6. Возвращать результат обработки

**Технические детали:**
- Использовать переменную окружения `OPENROUTER_API_KEY`
- Обрабатывать ошибки парсинга и AI запросов
- Установить `temperature: 0.7` для более креативных ответов
- Добавить системный промпт для каждого типа действия

---

### Этап 2: Обновление функции handleAction в page.tsx

**Файл:** `app/page.tsx`

**Действия:**
1. Заменить моковую логику в `handleAction` на реальный вызов API
2. Вызывать `/api/ai-process` с параметрами:
   - `url` - URL из поля ввода
   - `actionType` - тип действия (`summary`, `theses`, `telegram`)
3. Обработать ответ и отобразить результат в блоке результата
4. Добавить обработку ошибок с понятными сообщениями
5. Сохранить индикатор загрузки во время обработки

**Изменения в коде:**
```typescript
const handleAction = async (type: ActionType) => {
  // Валидация URL
  // Вызов /api/ai-process
  // Отображение результата
  // Обработка ошибок
}
```

---

### Этап 3: Оптимизация промптов для каждого типа действия

**Файл:** `app/api/ai-process/route.ts`

**Действия для каждого типа:**

#### 3.1. "О чем статья?" (summary)
- Промпт: "Прочитай следующую статью и напиши краткое описание на русском языке (2-3 абзаца). Опиши основную тему, ключевые моменты и выводы."
- Системный промпт: "Ты опытный журналист, который умеет кратко и точно излагать суть статей."

#### 3.2. "Тезисы" (theses)
- Промпт: "Выдели основные тезисы из следующей статьи. Представь их в виде маркированного списка на русском языке. Каждый тезис должен быть кратким и информативным."
- Системный промпт: "Ты аналитик, который умеет выделять ключевые идеи из текстов."
- Формат: маркированный список с символами `•` или `-`

#### 3.3. "Пост для Telegram" (telegram)
- Промпт: "Создай пост для Telegram канала на русском языке на основе следующей статьи. Используй эмодзи, добавь релевантные хештеги. Пост должен быть привлекательным и информативным."
- Системный промпт: "Ты SMM-специалист, который создает интересные посты для социальных сетей."
- Формат: текст с эмодзи, хештегами, возможно с разделителями

---

### Этап 4: Улучшение UX

**Файл:** `app/page.tsx`

**Действия:**
1. Добавить более информативные сообщения загрузки:
   - "О чем статья?" → "Анализирую статью..."
   - "Тезисы" → "Выделяю основные тезисы..."
   - "Пост для Telegram" → "Создаю пост..."
2. Улучшить отображение результатов:
   - Для тезисов - сохранить форматирование списка
   - Для поста Telegram - улучшить читаемость
3. Добавить возможность копирования результата (опционально)

---

### Этап 5: Обработка ошибок и edge cases

**Файлы:** `app/api/ai-process/route.ts`, `app/page.tsx`

**Действия:**
1. Обработать случаи, когда статья не найдена или пуста
2. Обработать ошибки OpenRouter API (лимиты, недоступность)
3. Добавить таймауты для длинных статей
4. Валидация длины контента перед отправкой в AI
5. Обработка случаев, когда AI возвращает пустой ответ

---

### Этап 6: Тестирование

**Действия:**
1. Протестировать каждую кнопку с реальными URL статей
2. Проверить работу с разными типами статей (новости, блоги, технические статьи)
3. Проверить обработку ошибок (неверный URL, отсутствие API ключа)
4. Проверить производительность и время ответа
5. Проверить форматирование результатов

---

## Порядок реализации

1. **Создать `/api/ai-process`** - базовая структура с одним типом действия (summary)
2. **Подключить к кнопке "О чем статья?"** - проверить работу
3. **Добавить поддержку "Тезисы"** - расширить API route
4. **Добавить поддержку "Пост для Telegram"** - завершить API route
5. **Обновить все кнопки** - заменить моки на реальные вызовы
6. **Улучшить промпты** - оптимизировать на основе тестирования
7. **Добавить обработку ошибок** - улучшить UX
8. **Финальное тестирование** - проверить все сценарии

---

## Технические требования

- **API:** OpenRouter AI (`https://openrouter.ai/api/v1/chat/completions`)
- **Модель:** `deepseek/deepseek-chat`
- **API ключ:** `OPENROUTER_API_KEY` из `.env.local`
- **Температура:** 
  - Summary: 0.5 (более точный)
  - Theses: 0.3 (более структурированный)
  - Telegram: 0.7 (более креативный)

---

## Примечания

- Все промпты должны быть на русском языке
- Результаты должны быть на русском языке
- Сохранять структуру и форматирование где возможно
- Обрабатывать длинные статьи (возможно, разбивать на части)

